{"version":3,"file":"OrbitControlsView.js","sourceRoot":"","sources":["../src/OrbitControlsView.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { View, Platform, ViewProps, PanResponder } from 'react-native';\nimport { Camera } from 'three';\n\nimport { OrbitControls } from './OrbitControls';\n\nexport type OrbitControlsViewProps = { camera: null | Camera } & ViewProps;\n\nfunction polyfillEventTouches(nativeEvent) {\n  if (Platform.OS === 'web') return nativeEvent;\n  if (!Array.isArray(nativeEvent.touches)) nativeEvent.touches = [];\n\n  if (Array.isArray(nativeEvent.changedTouches)) {\n    if (!nativeEvent.touches.length) {\n      nativeEvent.touches = nativeEvent.changedTouches;\n    }\n  }\n\n  return nativeEvent;\n}\n\nconst OrbitControlsView = React.forwardRef(\n  ({ camera, ...props }: OrbitControlsViewProps, ref) => {\n    const [size, setSize] = React.useState<null | {\n      width: number;\n      height: number;\n    }>(null);\n\n    const viewRef = React.useRef(null);\n\n    const controls: OrbitControls | null = React.useMemo(() => {\n      if (camera && viewRef?.current) {\n        return new OrbitControls(camera as any, viewRef.current);\n      }\n      return null;\n    }, [camera, viewRef?.current]);\n\n    React.useImperativeHandle(\n      ref,\n      () => ({\n        getControls(): OrbitControls | null {\n          return controls;\n        },\n      }),\n      [controls]\n    );\n\n    const responder = React.useMemo(() => {\n      function onTouchEnded(nativeEvent) {\n        const polyfill = polyfillEventTouches(nativeEvent);\n\n        // If only one touch then we may be encountering the bug where pan responder returns a two finger touch-end event in two different calls. :/\n        // RNGH doesn't have this issue.\n        const isMisfiredNativeGesture =\n          Platform.OS !== 'web' && nativeEvent.identifier > 1;\n\n        if (isMisfiredNativeGesture) {\n          return;\n        }\n\n        return controls?.onTouchEnd(polyfill);\n      }\n\n      return PanResponder.create({\n        onStartShouldSetPanResponder: (evt, gestureState) => true,\n        onStartShouldSetPanResponderCapture: (evt, gestureState) => true,\n        onMoveShouldSetPanResponder: (evt, gestureState) => true,\n        onMoveShouldSetPanResponderCapture: (evt, gestureState) => true,\n\n        onPanResponderGrant({ nativeEvent }) {\n          return controls?.onTouchStart(nativeEvent);\n        },\n        onPanResponderMove({ nativeEvent }) {\n          return controls?.onTouchMove(nativeEvent);\n        },\n        onPanResponderRelease({ nativeEvent }) {\n          return onTouchEnded(nativeEvent);\n        },\n        onPanResponderTerminate({ nativeEvent }) {\n          return onTouchEnded(nativeEvent);\n        },\n      });\n    }, [controls]);\n\n    React.useEffect(() => {\n      if (!controls || !size) {\n        return;\n      }\n      controls.width = size.width;\n      controls.height = size.height;\n    }, [size, controls]);\n\n    return (\n      <View\n        {...props}\n        ref={viewRef}\n        {...responder.panHandlers}\n        onLayout={event => {\n          if (props.onLayout) {\n            props.onLayout(event);\n          }\n          setSize(event.nativeEvent.layout);\n        }}\n      />\n    );\n  }\n);\n\nexport default OrbitControlsView;\n"]}